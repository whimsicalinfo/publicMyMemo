# 数理最適化・アルゴリズム総合ハンドブック

## 1. はじめに：数理最適化とは
現実の問題を「数式（モデル）」に落とし込み、与えられた条件下で「最良の答え（最小のコスト、最大の利益など）」をコンピュータで見つけ出す技術。

---

## 2. 問題の種類と定義

| 問題の種類 | 特徴 | 難易度 | 具体例 |
| :--- | :--- | :--- | :--- |
| **線形計画問題 (LP)** | 数式がすべて「1次式（直線）」で表される。変数は連続値（小数OK）。 | 易しい (P) | ジュースの混合比率、工場の生産量配分 |
| **整数計画問題 (IP/MIP)** | 変数が「整数」に限定される（0か1、個数など）。 | 難しい (NP困難) | 配送ルート（行く/行かない）、シフト作成 |
| **ネットワークフロー問題** | 「点」と「線」のグラフ上で、モノの流れを最適化する。 | 易しいものが多い | 最短経路、パイプラインの最大流量 |
| **非線形計画問題** | 数式に2乗や曲線が含まれる。 | 非常に難しい | 複雑な物理シミュレーション、金融工学 |

---

## 3. 主要アルゴリズムと具体的手法

### 3.1 線形・整数計画系（厳密解法）

#### **単体法 (Simplex Method)**
* **概念:** 「多面体の頂点渡り歩き」
* **たとえ:** 凸凹のない滑り台の一番低い場所を探すとき、壁沿い（辺）をつたって角（頂点）を移動していけば、いつか一番下にたどり着く。
* **用途:** 原料の配合最適化、大規模な資源配分。

#### **分枝限定法 (Branch and Bound)**
* **概念:** 「パラレルワールド作戦」
* **たとえ:** 答えが「2.5台」と出たら、「2台以下の世界」と「3台以上の世界」に分岐させてしらみつぶしにする。見込みのない世界は早めに切り捨てる。
* **用途:** あらゆる整数計画問題（シフト作成、拠点の選定）。

#### **切除平面法 / 分枝カット法**
* **概念:** 「彫刻刀で削り出し」
* **たとえ:** 答えが小数になったら、その部分だけを禁止する「新しい壁（不等式）」を追加して、正解の整数を包囲していく。
* **用途:** 現代の商用ソルバー（Gurobi等）のエンジン部分。

---

### 3.2 ネットワーク・グラフ系

#### **ダイクストラ法 (Dijkstra)**
* **概念:** 「確定領土の拡大」
* **たとえ:** スタート地点から、近い順に「ここはもう最短で確定！」と旗を立てていき、徐々に領土を広げる。
* **注意点:** 負のコスト（お金が貰える道）があると使えない。
* **物流での用途:** カーナビのルート検索、鉄道の乗換案内。

#### **ベルマン・フォード法**
* **概念:** 「慎重な総点検」
* **たとえ:** 「もっと安いルートはないか？」とすべての道を何度もチェックする。
* **強み:** 負のコストがあっても計算可能。無限にお金が増えるバグ（負閉路）も検知できる。

#### **最大流問題 (Ford-Fulkerson)**
* **概念:** 「ボトルネック探し」
* **たとえ:** 水道管に水を限界まで流したい。どこが詰まっているか（最小カット）を見つければ、限界量がわかる。
* **物流での用途:** 鉄道やトラックの輸送容量の上限計算。

#### **最小費用流問題**
* **概念:** 「需要と供給の最安マッチング」
* **たとえ:** 工場A, Bから店C, Dへ、在庫切れを起こさずに一番安く運ぶには？（負閉路消去法：お得な循環ルートを見つけて書き換える）。
* **物流での用途:** サプライチェーン全体のコスト最適化。

---

### 3.3 組合せ最適化の近似アルゴリズム（妥協解法）
「厳密な正解」を諦め、短時間で「そこそこの正解」を出す手法。

#### **ナップサック問題（詰め込み）**
* **貪欲法:** コスパ（価値÷重さ）が良い順に詰める。
* **FPTAS（近似スキーム）:** 価値の端数を切り捨てて（12345円→123百円）、動的計画法を高速化する。

#### **ビンパッキング問題（箱詰め）**
* **FFD法 (First-Fit Decreasing):** 荷物を「大きい順」に並べ替え、前から順に隙間に詰める。
* **物流での用途:** コンテナへのパレット積載シミュレーション、トラックの台数見積もり。

#### **巡回セールスマン問題 (TSP)**
* **木二重化法:** 行って帰って（2倍）、重複をショートカットする。
* **クリストフィデス法:** 「奇数の次数の都市」だけをうまく繋いで、1.5倍以内の誤差に抑える。
* **物流での用途:** 配送ルートの順序決め（ルーティング）。

#### **頂点被覆問題（監視カメラ配置）**
* **丸め法:** 線形計画法で「0.7台置く」みたいな答えを出し、四捨五入して配置を決める。

---

## 4. メタヒューリスティクス（発見的解法）
近似アルゴリズムで作った答えを、さらに磨き上げて「世界最高峰」を目指すAI的な手法。

### 4.1 基本戦略
* **局所探索法 (Local Search):** 今いる場所の「隣（近傍）」を見て、良くなるなら移動する。
    * **高速化のコツ:** 差分計算（変わった所だけ計算）、近傍リスト（遠くは見ない）、DLB（昨日ダメだった場所は見ない）。
* **多スタート法:** ヘリコプターで何度もランダムな場所に降りて、そこから登山する。

### 4.2 応用戦略（局所解からの脱出）

| アルゴリズム | キャッチコピー | 戦略の内容 |
| :--- | :--- | :--- |
| **アニーリング法 (SA)** | **気まぐれな熱処理** | 最初は「改悪」も確率で許す（高温）。徐々に真面目になる（冷却）。 |
| **タブー探索法 (TS)** | **記憶力の勝利** | 「さっき通った道は通行止め（タブー）」にして、無理やり未知の道へ進む。 |
| **遺伝的アルゴリズム (GA)** | **進化論の実践** | 複数の解を戦わせ、交配（交叉）と突然変異で優秀な子孫を残す。 |
| **反復局所探索 (ILS)** | **幅跳び** | 行き詰まったら、大きくジャンプ（摂動/Double Bridge）して再開する。 |
| **可変近傍探索 (VNS)** | **ギアチェンジ** | 小さな変化でダメなら、変化の幅を広げてみる。 |
| **誘導局所探索 (GLS)** | **落とし穴埋め** | 行き詰まった場所（特徴）に「罰金」を課して、居心地を悪くして追い出す。 |
| **ラグランジュヒューリスティクス** | **アメとムチ** | 厳しい制約を「罰金」に置き換えて計算し、最後に手作業（貪欲法）で修正する。 |

---

## 5. 現実問題での使われ方（物流・交通分野）

| 業務 | 使うべき手法の例 | 解説 |
| :--- | :--- | :--- |
| **カーナビ・経路検索** | **ダイクストラ法** (A*) | 道路ネットワーク上の最短時間を瞬時に計算。 |
| **配送計画 (VRP)** | **タブー探索 / SA / GLS** | 「どのトラックが、どの順で回るか」。制約（時間指定、積載量）が厳しいため、メタヒューリスティクスが必須。 |
| **トラックの積載** | **FFD法 / 遺伝的アルゴリズム** | 3Dビンパッキング。荷崩れ防止などの複雑なルールにはGAなどが強い。 |
| **倉庫の在庫配置** | **最小費用流問題** | 入荷から出荷までの動線を最小化。 |
| **シフト作成** | **分枝カット法 / タブー探索** | 「3連勤まで」「夜勤明けは休み」などの複雑なルールを満たす整数計画。 |
| **鉄道ダイヤ作成** | **ラグランジュ緩和 + 局所探索** | 極めて制約が厳しいため、罰金形式（緩和）にして解くことが多い。 |

---

## 6. ソルバー（計算機）マップ

自力でアルゴリズムを実装するのではなく、既存の「ソルバー」を使うのが実務の定石。

### 6.1 商用ソルバー（性能は最強、高価）
* **Gurobi Optimizer:** 現在の世界最速ソルバー。線形・整数計画に圧倒的に強い。
* **CPLEX (IBM):** Gurobiと双璧をなす老舗。安定性が高い。
* **FICO Xpress:** こちらも高性能。

**得意な問題:** 線形計画(LP)、整数計画(MIP)、二次計画(QP)。
**苦手な問題:** 複雑な非線形、ブラックボックス最適化。

### 6.2 非商用・オープンソース（無料、性能は商用に劣る）
* **SCIP:** 無料の中では最強クラス。研究用途でよく使われる。
* **CBC (Coin-OR):** Pythonライブラリ（PuLP等）のデフォルトで入っていることが多い。
* **GLPK:** 古くからあるが、大規模問題には遅い。

### 6.3 特化型・ヒューリスティックソルバー
* **LocalSolver (Hexaly):** 厳密解ではなく「良質な近似解」を高速に出すことに特化。非線形や複雑な制約に強い。
* **Google OR-Tools:** Google製。特に「配送計画(VRP)」や「グラフ理論」に強いエンジンを内蔵。無料。

### 6.4 Pythonライブラリ（ソルバーへの命令役）
これらはソルバーではなく「モデリング言語」。
* **PuLP:** 初心者向け。記述が簡単。
* **GurobiPy:** Gurobi専用。機能が豊富。
* **NetworkX:** グラフ・ネットワーク分析専用（最短路、最大流など）。

---

## 7. まとめ：どう使い分けるか

1.  **地図上のルートを探したい**
    * $\rightarrow$ **ダイクストラ法** (NetworkXなど)
2.  **数式で綺麗に書ける計画を立てたい（生産計画など）**
    * $\rightarrow$ **線形計画法 (LP)** (Gurobi, PuLP)
3.  **Yes/Noや個数を決めたい（シフト、拠点配置）**
    * $\rightarrow$ **整数計画法 (MIP)** (Gurobi, CBC)
4.  **ルールが複雑すぎて数式にならない、とにかく早く答えが欲しい（配送ルート、積載）**
    * $\rightarrow$ **メタヒューリスティクス** (LocalSolver, Google OR-Tools, または自作の局所探索/SA)
